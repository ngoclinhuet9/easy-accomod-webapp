{"ast":null,"code":"import _regeneratorRuntime from \"/Users/linhvtn/Desktop/workspace/easy-accomod-webapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/linhvtn/Desktop/workspace/easy-accomod-webapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(logInByEmailAndPasswordSaga),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(signUpByEmailAndPasswordSaga),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(watchAuth);\n\nimport { put, takeEvery } from 'redux-saga/effects';\nimport { auth } from 'firebase-config';\nimport axios from 'utils/axios';\nimport actions from '../actions';\nvar loginByEmailAndPassword = actions.loginByEmailAndPassword,\n    authSuccess = actions.authSuccess,\n    signupByEmailAndPassword = actions.signupByEmailAndPassword,\n    pushError = actions.pushError;\n\nfunction logInByEmailAndPasswordSaga(_ref) {\n  var payload, _auth$currentUser, token;\n\n  return _regeneratorRuntime.wrap(function logInByEmailAndPasswordSaga$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          payload = _ref.payload;\n          _context2.prev = 1;\n          _context2.next = 4;\n          return auth.signInWithEmailAndPassword(payload.email, payload.password).catch( /*#__PURE__*/function () {\n            var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(error) {\n              var errorCode, errorMessage;\n              return _regeneratorRuntime.wrap(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      errorCode = error.code;\n                      errorMessage = error.message;\n\n                      if (errorCode === 'auth/wrong-password') {\n                        alert('Wrong password.');\n                      } else {\n                        alert(errorMessage);\n                      }\n\n                    case 3:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _callee);\n            }));\n\n            return function (_x) {\n              return _ref2.apply(this, arguments);\n            };\n          }());\n\n        case 4:\n          _context2.next = 6;\n          return auth === null || auth === void 0 ? void 0 : (_auth$currentUser = auth.currentUser) === null || _auth$currentUser === void 0 ? void 0 : _auth$currentUser.getIdToken(true);\n\n        case 6:\n          token = _context2.sent;\n          localStorage.setItem('token', token);\n\n          if (!token) {\n            _context2.next = 11;\n            break;\n          }\n\n          _context2.next = 11;\n          return put(authSuccess(token));\n\n        case 11:\n          _context2.next = 16;\n          break;\n\n        case 13:\n          _context2.prev = 13;\n          _context2.t0 = _context2[\"catch\"](1);\n          console.log(_context2.t0);\n\n        case 16:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked, null, [[1, 13]]);\n}\n\nfunction signUpByEmailAndPasswordSaga(_ref3) {\n  var payload, _auth$currentUser2, token, domain;\n\n  return _regeneratorRuntime.wrap(function signUpByEmailAndPasswordSaga$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          payload = _ref3.payload;\n          _context3.prev = 1;\n          _context3.next = 4;\n          return auth.createUserWithEmailAndPassword(payload.email, payload.password).catch(function (error) {\n            // Handle Errors here.\n            var errorCode = error.code;\n            var errorMessage = error.message;\n\n            if (errorCode === 'auth/weak-password') {\n              alert('The password is too weak.');\n            } else {\n              alert(errorMessage);\n            }\n          });\n\n        case 4:\n          _context3.next = 6;\n          return auth === null || auth === void 0 ? void 0 : (_auth$currentUser2 = auth.currentUser) === null || _auth$currentUser2 === void 0 ? void 0 : _auth$currentUser2.getIdToken(true);\n\n        case 6:\n          token = _context3.sent;\n          localStorage.setItem('token', token);\n          debugger;\n\n          if (!token) {\n            _context3.next = 22;\n            break;\n          }\n\n          _context3.next = 12;\n          return put(authSuccess(token));\n\n        case 12:\n          domain = window.location.hostname.split('.');\n\n          if (!(domain.length === 1)) {\n            _context3.next = 16;\n            break;\n          }\n\n          _context3.next = 16;\n          return axios.post('/renters/create', {\n            email: payload.email,\n            name: payload.name\n          });\n\n        case 16:\n          if (!(domain.length === 2)) {\n            _context3.next = 21;\n            break;\n          }\n\n          if (!(domain[0] === 'owner')) {\n            _context3.next = 21;\n            break;\n          }\n\n          debugger;\n          _context3.next = 21;\n          return axios.post('/owners/create', {\n            email: payload.email,\n            name: payload.name,\n            identity: payload.identity,\n            phone: payload.phone,\n            address: payload.address\n          });\n\n        case 21:\n          debugger;\n\n        case 22:\n          _context3.next = 27;\n          break;\n\n        case 24:\n          _context3.prev = 24;\n          _context3.t0 = _context3[\"catch\"](1);\n          console.log(_context3.t0);\n\n        case 27:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked2, null, [[1, 24]]);\n}\n\nexport function watchAuth() {\n  return _regeneratorRuntime.wrap(function watchAuth$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return takeEvery(loginByEmailAndPassword.type, logInByEmailAndPasswordSaga);\n\n        case 2:\n          _context4.next = 4;\n          return takeEvery(signupByEmailAndPassword.type, signUpByEmailAndPasswordSaga);\n\n        case 4:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked3);\n}","map":{"version":3,"sources":["/Users/linhvtn/Desktop/workspace/easy-accomod-webapp/src/store/sagas/auth.ts"],"names":["logInByEmailAndPasswordSaga","signUpByEmailAndPasswordSaga","watchAuth","put","takeEvery","auth","axios","actions","loginByEmailAndPassword","authSuccess","signupByEmailAndPassword","pushError","payload","signInWithEmailAndPassword","email","password","catch","error","errorCode","code","errorMessage","message","alert","currentUser","getIdToken","token","localStorage","setItem","console","log","createUserWithEmailAndPassword","domain","window","location","hostname","split","length","post","name","identity","phone","address","type"],"mappings":"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","sourcesContent":["import { put, takeEvery } from 'redux-saga/effects'\nimport { auth } from 'firebase-config'\nimport axios from 'utils/axios'\nimport actions from '../actions'\n\nconst {\n  loginByEmailAndPassword,\n  authSuccess,\n  signupByEmailAndPassword,\n  pushError,\n} = actions\n\nfunction* logInByEmailAndPasswordSaga({\n  payload,\n}: ReturnType<typeof loginByEmailAndPassword>) {\n  try {\n    yield auth\n      .signInWithEmailAndPassword(payload.email, payload.password)\n      .catch(async (error) => {\n        let errorCode = error.code\n        let errorMessage = error.message\n        if (errorCode === 'auth/wrong-password') {\n          alert('Wrong password.')\n        } else {\n          alert(errorMessage)\n        }\n      })\n    const token = yield auth?.currentUser?.getIdToken(true)\n    localStorage.setItem('token', token)\n    if (token) {\n      yield put(authSuccess(token))\n    }\n  } catch (e) {\n    console.log(e)\n  }\n}\n\nfunction* signUpByEmailAndPasswordSaga({\n  payload,\n}: ReturnType<typeof signupByEmailAndPassword>) {\n  try {\n    yield auth\n      .createUserWithEmailAndPassword(payload.email, payload.password)\n      .catch((error) => {\n        // Handle Errors here.\n        let errorCode = error.code\n        let errorMessage = error.message\n        if (errorCode === 'auth/weak-password') {\n          alert('The password is too weak.')\n        } else {\n          alert(errorMessage)\n        }\n      })\n    const token = yield auth?.currentUser?.getIdToken(true)\n    localStorage.setItem('token', token)\n    debugger\n    if (token) {\n      yield put(authSuccess(token))\n      const domain = window.location.hostname.split('.')\n      if (domain.length === 1) {\n        yield axios.post('/renters/create', {\n          email: payload.email,\n          name: payload.name,\n        })\n      }\n      if (domain.length === 2) {\n        if (domain[0] === 'owner') {\n          debugger\n          yield axios.post('/owners/create', {\n            email: payload.email,\n            name: payload.name,\n            identity: payload.identity,\n            phone: payload.phone,\n            address: payload.address,\n          })\n        }\n      }\n\n      debugger\n    }\n  } catch (e) {\n    console.log(e)\n  }\n}\n\nexport function* watchAuth() {\n  yield takeEvery(loginByEmailAndPassword.type, logInByEmailAndPasswordSaga)\n  yield takeEvery(signupByEmailAndPassword.type, signUpByEmailAndPasswordSaga)\n}\n"]},"metadata":{},"sourceType":"module"}